# 23 Three.js解决方案之加载.obj模型

本文将开始 Three.js 新的篇章—— Three.js 各种应用场景的解决方案。

有 2 点会与之前的篇章不同：

1. 讲解内容时尽量简要，不再像前面 01-22 篇章那样啰嗦
2. 和原版官方教程内容上略有不同，删除我认为没有必要的内容、增加上我自己补充的内容。



<br>

**特别强调 1：从本文示例开始，我们将升级 React 和 Three.js 的版本**

1. react  由原来的 17.0.2 升级为 17.0.3

2. 重点是 Three.js 由原来的 0.125.2 升级为 0.127.0

   > 由于 Three.js 版本迭代，对于某些类的引用路径、方法和属性的使用 难免会有一些变化。

3. 由于 Three.js 在 0.126.0 版本时已经默认不包含 .d.ts 文件，所以我们还需要额外单独安装 对应的 typescript 类型定义文件包

   ```
   yarn add @types/three
   
   //npm i @types/three
   ```



<br>

**特别强调 2：尽管我们在前一章节花了非常多的时间研究出如果在 Web Worker 中渲染和控制 Threejs 3D 场景，但是本示例并不会选择使用 web worker，依然会选择直接在 JS 主场景中创建 3D 场景。**



<br>

正文开始...



<br>

**前言小絮**

在之前所有的示例中，场景中的 3D 物体元素都是直接在 Three.js 中创建的，但是 Three.js 毕竟不是专业的 3D 建模软件，所以实际工作中，我们更多的都是在传统 3D 建模软件中创建好模型，然后将模型导出成特定格式的文件，然后在 Three.js 中使用特定的加载器，将这些模型加载进来。



<br>

#### 让我们开始使用 Blender

尽管我更喜欢 C4D 这个软件，但是由于 C4D 为收费软件，所以在本教程中，我们将更多的使用 Blender 这个免费的 3D 建模软件。

国外人很注意版权，所以很多教程中也都使用的是 Bleander。

假设你希望自己创建的模型或者项目要跟别人交流，而你使用破解版的 C4D ，多少有一些隐患。



<br>

#### Blender软件下载安装

Blender 不光免费，而且还支持简体中文。

> 当前版本为 2.92.0

下载地址：https://www.blender.org/download/

> 软件安装好之后，第一次启动 Blender 时会有一个弹窗，在弹窗中将界面语言由 English 修改为 简体中文，这样软件界面就变成 简体中文了。



<br>

**关于Blender的基础用法，请参考我另外一篇学习笔记：[Blender基础教程](https://github.com/puxiao/notes/blob/master/Blender%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B.md)**

我也是刚开始学习 Blender，感兴趣一起学习吧。

> 我本身就会一些基础的 C4D 软件操作，所以在学习 Blender 时并没有感觉特别吃力，只是觉得 Blender 各种操作的快捷键实在是太多了，有点难记。如果你是第一次接触 3D 建模软件，那...只能说，加油！ 



<br>

#### 使用Blender创建并导出3D模型——.obj文件

启动 Blender 之后，默认场景上有一个立方体，我们再添加几个其他元素，如 圆柱体、圆锥体、球体。

> 注：在 Blender 中，球体 被称为 融球

我们只是简单将这几个元素修改一下位置，不做任何属性的调整，然后就直接导出模型。

> 为什么不做复杂的调整？  
> 答：因为我也刚学 Blender，还不太会，就先这样吧。



<br>

现在我们要导出刚才创建的 3D 场景元素，执行：

**文件 > 导出 > Wavefront(obj)**

在弹出的导出选项弹出中，我们什么也不修改，直接点击 导出OBJ，我们将文件名设置为 hello.obj。

> 以下为默认的导出参数
>
> 在 Objects as 选项中：
>
> 1. OBJ 物体 (默认已勾选)
> 2. OBJ组 (默认未被勾选)
> 3. 材质组 (默认未被勾选)
> 4. 动画 (默认未被勾选)
>
> 在 变换 选项中：
>
> 1. 缩放：1.00 (默认值)
> 2. 路径模式：自动  (默认值)
> 3. 前进：-Z 前进  (默认值)
> 4. 向上：Y 向上  (默认值)
>
> 在 集合数据 选项中：
>
> 1. 应用修改器 (默认已勾选)
> 2. 平滑组 (默认未被勾选)
> 3. Bitflag平滑组 (默认未被勾选)
> 4. 写入法线 (默认已勾选)
> 5. 包括UV (默认已勾选)
> 6. 写入材质 (默认已勾选)
> 7. 三角面 (默认未被勾选)
> 8. Curves as NURBS (默认未被勾选)
> 9. 多边形组 (默认未被勾选)
> 10. 保持顶点顺序 (默认未被勾选)



<br>

当导出完成后，我们会看到实际上产生了 2 个新文件：

1. hello.obj
2. hello.mtl

特别说明一下：

1. .obj 这个文件是用来储存 3D模型 数据的

   > 请注意这里面只包含 3D模型 的数据和模型位置信息，并不包含 Blender 场景中的镜头和灯光

2. .mtl 这个文件是用来储存 材质 数据的

   > 尽管目前我们并未在 Blender 中给元素添加材质，但是依然会产生这个文件



<br>

我们将得到的 hello.obj 文件拷贝到 React 项目中，路径为 src/assets/model/hello.obj

接下来我们要开始编写 Three.js 相关代码了。



<br>

#### 加载 .obj 模型文件对应的类(加载器)为 OBJLoader

src/components/hello-objloader/index.tsx



