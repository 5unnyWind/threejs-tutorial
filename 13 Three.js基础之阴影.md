# 13 Three.js基础之阴影

## 阴影(Shadow)概述

#### LightShadow

在 Three.js 中，所有阴影的基类都是 Three.LightShadow。

请注意：不能直接去实例化 LightShadow，平时真正去创建的阴影，都是该类的之类。



#### 阴影类型

目前，一共有 3 种阴影，通过名字基本都可以猜出对应的灯光的类型。

| 阴影类型(都继承于LightShadow) | 阴影名称   | 解释说明                   |
| ----------------------------- | ---------- | -------------------------- |
| PointLightShadow              | 点光源阴影 | 对应 PointLight 光源       |
| DirectionalLightShadow        | 平行光阴影 | 对应 DirectionalLight 光源 |
| SpotLightShadow               | 聚光灯阴影 | 对应 SpootLight 光源       |

**注意：DirectionalLightShadow只能使用 OrthographicCamera 镜头来计算阴影，无法在 PerspectiveCamera 镜头下使用。**

> 这是因为 PerspectiveCamera 的光线是平行的。



#### 阴影贴图

默认情况下 Three.js 使用阴影贴图来绘制阴影。

**何为 “阴影贴图” ？**

答：所谓 ”贴图“，你可以想象成 ”一层层窗户纸“。

假设现在有一个窗户，你可以一层一层的粘贴不同透明度的窗户纸，每一层窗户纸都会叠加到之前的那一层，最终窗户纸所呈现的效果是所有窗户纸最终合并后一块呈现的效果。

当然，由于阴影都是黑灰色，不存在彩色，所以上面的举例中，窗户纸都是不同透明度(明暗度)的，不需要考虑窗户纸的颜色。



**阴影的实际渲染过程：**

假设目前场景下，有 5 个可产生阴影的灯光、20 个阴影对象。

那么最终渲染出的阴影，所经历的过程如下：

1. 使用 第1个灯光 渲染出一份 20 个阴影对象
2. 使用 第2个灯光 渲染出一份 20 个阴影对象
3. ...
4. 使用 第5个灯光 渲染出一份 20 个阴影对象
5. 最终将 5 次渲染的阴影结果进行合并，得出最终的阴影

从上述渲染过程可以看出，每多一个可产生阴影的光源、阴影对象，则需要多渲染一次场景。

**由此可见，阴影的渲染需要大量的计算和性能。**



#### 降低阴影所需性能的解决办法

**方案1：可以有多个灯光，但只有一个平行光可产生阴影**

**方案2：使用 光照贴图 或 环境光照遮挡贴图 来预先计算离线照明的效果**

**方案3：使用 假阴影，添加一个平面放到物体下方的地面上，同时赋予一个看着像阴影的纹理图片材质**

方案1、方案2 我们会在以后再详细讲述学习，本文先实现一下方案3。



**补充说明：**

对于绝大多数 游戏场景 来说，人物脚下的阴影都是采用 方案3 的策略，一般人们是可以接受这种假阴影。

这种假阴影对渲染性能的提升非常大。



## 假阴影示例：HelloFakeShadow

